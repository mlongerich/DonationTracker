# Pre-commit Hooks Configuration for Donation Tracker
# Install with: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Built-in pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # General file validation
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-merge-conflict
      - id: check-added-large-files
        args: ['--maxkb=500']

      # Security: Prevent sensitive files from being committed
      - id: detect-private-key

  # Commit message validation for our custom prefixes
  - repo: local
    hooks:
      - id: commit-msg-validation
        name: Validate commit message prefixes
        entry: bash -c 'if ! grep -qE "^(backend|frontend|docs|feat|fix|chore|docker):" "$1"; then echo "❌ Commit message must start with one of: backend:, frontend:, docs:, feat:, fix:, chore:, docker:"; exit 1; fi'
        language: system
        stages: [commit-msg]
        pass_filenames: false
        args: ['.git/COMMIT_EDITMSG']

      # Documentation reminder (non-blocking warning)
      - id: documentation-reminder
        name: Documentation update reminder
        entry: scripts/check-documentation.sh
        language: script
        stages: [pre-commit]
        pass_filenames: false
        verbose: true

      # Backend validation (Rails API)
      - id: backend-validation
        name: Backend code quality checks
        entry: scripts/pre-commit-backend.sh
        language: script
        files: ^donation_tracker_api/
        exclude: ^donation_tracker_api/(tmp/|log/|coverage/|spec/pacts/)

      # Frontend validation (React)
      - id: frontend-validation
        name: Frontend code quality checks
        entry: scripts/pre-commit-frontend.sh
        language: script
        files: ^donation_tracker_frontend/
        exclude: ^donation_tracker_frontend/(node_modules/|build/|coverage/|pacts/)

      # Prevent sensitive files specific to our project
      - id: prevent-sensitive-files
        name: Prevent sensitive files from being committed
        entry: bash -c 'if git diff --cached --name-only | grep -qE "(master\.key|\.pem|\.crt|secret|credential)$"; then echo "❌ Sensitive file detected in commit!"; exit 1; fi'
        language: system
        stages: [pre-commit]
        pass_filenames: false

  # Optional: Conventional commits validation (alternative to our custom one)
  # - repo: https://github.com/compilerla/conventional-pre-commit
  #   rev: v3.0.0
  #   hooks:
  #     - id: conventional-pre-commit
  #       stages: [commit-msg]
  #       args: [backend, frontend, docs, feat, fix, chore, docker]

# Configuration for specific hooks
fail_fast: false  # Continue running hooks even if one fails
default_install_hook_types: [pre-commit, commit-msg]